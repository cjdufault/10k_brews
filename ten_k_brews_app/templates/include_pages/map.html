{% block map %}
{% if mobile %}
    <div id="map-id" style="width: 300px; height: 200px;"></div>
{% else %}
    <div id="map-id" style="width: 600px; height: 400px;"></div>
{% endif %}
<script>
{% if mobile %}
    var location_map = L.map('map-id').setView([{{ focus_lat }}, {{ focus_lon }}], {{ mobile_zoom }});
{% else %}
    var location_map = L.map('map-id').setView([{{ focus_lat }}, {{ focus_lon }}], {{ zoom_level }});
{% endif %}

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={{ mapbox_token }}', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(location_map);
    L.control.scale().addTo(location_map);

    {% for establishment in map_establishments %}
        var establishment{{ establishment.pk }} = L.marker([{{ establishment.latitude }}, {{ establishment.longitude }}]).addTo(location_map);
        establishment{{ establishment.pk }}.bindPopup('<a href="{% url 'establishment_detail' establishment_pk=establishment.pk %}">{{ establishment }}</a>');
    {% endfor %}
</script>
{% endblock %}